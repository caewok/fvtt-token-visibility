Visibility approach 2025-09

Obstructions for visibility test
- Can vary based on options. Walls, Tiles, Regions (walls), Tokens
- Visible based on considering the full token vs visible based on single grid space of token ("large tokens")

Bright/dim/dark light on target token should be handled considering the entire token (not face-specific)
Lighting does not depend on facing the light --- i.e., backlit tokens are still in bright or dim light.
Reasonable to assume substantial amount of light bouncing, plus tokens are smaller and more complex than block shapes.


Bright/dim/dark light can depend on whether there is an obstruction. Same for bright/dark sound.
- Ignore token obstructions. Vary too much and tokens would not necessarily fully block the light
- Using whole token, so simplest is to use existing point calculator.
- For given points on token, determine maximum for each light: bright/dim/none. Then determine percentage of total.

For example, assuming 9 points, where x is none / o is dim / • is bright
Light 1:
x o •
x o •
o o •

Light 2:
o x x
x o •
x • • 

Combined:
o o •
x o •   => 4/9 (44%) bright; 4/9 (44%) dim; 1/9 (11%) none.
o • •


Could use faces instead and measure area covered for each face, taking max % area where two lights hit the face.
Harder, but matches with geometry for viewer/sight algorithm.

So each algorithm should return the bright/dim/none object and allow combining.



Viewer --> object

Viewer:
- Point in 3d space
- Options controlling rules for blocking. E.g., light would not be blocked by tokens.
- A source type, indicating the corresponding wall restriction. E.g., sight/sound/move/light
- Radius indicating to what distance the viewer can see. Can be infinite.

Object:
- For now, only tokens.
- 3d objects with defined faces.

Points (2d or 3d within token shape)




Visibility

