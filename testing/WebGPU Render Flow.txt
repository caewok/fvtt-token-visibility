WebGPU class hierarchy

DrawableObjectsAbstract
- DrawableObjectPlaceableAbstract
  - DrawableObjectInstancesAbstract
    - DrawableConstrainedTokens
      - DrawableLitTokens
    - DrawableTileInstances
    - DrawableObjectCulledInstancesAbstract
      - DrawableObjectRBCulledInstancesAbstract
        - DrawableTokenInstances
          - DrawableHexTokenInstances
          - DrawableGridInstances
        - DrawableWallInstances
          - DrawableNonTerrainWallInstances
          - DrawableTerrainWallInstances

WebGPU Render process

RenderObstacles#initialize
  --> RenderObstacles#_initializeDrawObjects
        --> For each drawable object, initialize. (A)
  --> RenderObstacles#_allocateRenderTargets (handles the render texture)

(A)
DrawableTokenInstances#initialize (n/a)
DrawableObjectRBCulledInstancesAbstract#initialize (n/a)
DrawableObjectCulledInstancesAbstract#initialize
  --> super.initialize (B)
  --> _createIndirectBuffer
  --> _createCulledBuffer

(B)
DrawableObjectInstancesAbstract#initialize (n/a)
DrawableObjectPlaceableAbstract#initialize
  --> super.initialize (C)
  --> this.placeableHandler.initializePlaceables

(C)
DrawableObjectAbstract#initialize
  --> shaders
  --> _createPipeline
  --> _createStaticGeometries
  --> _createStaticDrawables
  --> _setStaticGeometriesBuffers


RenderObstacles#render
  --> foreach drawableObstacles, filterObjects
  device.createCommandEncoder()
  --> foreach drawableObstacles, prerender(commandEncoder) (D)
  --> if (useLit ) drawableLitToken.prerender(commandEncoder)
  commandEncoder.beginRenderPass
  --> drawableConstrainedToken|drawableLitToken.renderTarget(renderPass, target)
  --> foreach drawableObstacles, render(renderPass, opts) (E)
  renderPass.end()
  --> foreach drawableObstacles, postrender
  --> drawableConstrainedToken|drawableLitToken.postrender (F)

(D)
DrawableTokenInstances.prerender
--> Update placeables.
--> super
DrawableObjectInstancesAbstract.prerender
--> super (D.1)
--> placeableHandler.updateId > this.placeableHandlerUpdateId: partialUpdateInstanceBuffer
--> commandEncoder.copyBufferToBuffer for the instanceTransfer
(D.1)
DrawableObjectPlaceableAbstract.prerender
--> this.placeableHandler.bufferId > this.#placeableHandlerBufferId: updatePlaceableBuffers

(E)
DrawableObjectsAbstract#render
--> foreach drawable _initializeRenderPass, _renderDrawable

DrawableObjectRBCulledInstancesAbstract#render
--> Creates render bundle or executes it.
--> If creating a bundle, calls super.render. So calls DrawableObjectsAbstract#render.
--> ** Any child of DrawableObjectRBCulledInstancesAbstract should not use render directly. **
  - DrawableWallInstances
    - DrawableNonTerrainWallInstances
    - DrawableTerrainWallInstances
  - DrawableTokenInstances
    - DrawableHexTokenInstances
    - DrawableGridInstances

_initializeRenderPass


DrawableConstrainedTokens#_initializeRenderPass
--> skipped (called in _renderDrawable) during the render

DrawableObjectInstancesAbstract#_initializeRenderPass
--> super
--> sendBindGroup (INSTANCE)
DrawableObjectsAbstract#_initializeRenderPass
--> foreach drawable
  --> setPipeline
  --> setBindGroup



